# Socket.IO –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ –æ—Ä–±–∏—Ç

## üîå –û–±–∑–æ—Ä

–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Socket.IO –¥–ª—è real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –±—ç–∫–µ–Ω–¥–æ–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –æ—Ä–±–∏—Ç –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

## üì° Socket.IO API

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
const socket = socketService.connect();

// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫
{
  auth: {
    token: `Bearer ${authToken}`;
  }
}
```

### –°–æ–±—ã—Ç–∏—è

#### –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è (–∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä)

##### `calculate` - –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–∞

```typescript
socket.emit('calculate', {
  observations: [
    {
      ra_hours: 11,
      dec_degrees: 12,
      timestamp: 1761473781,
    },
    // ... –µ—â–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 3)
  ],
  authorization: `Bearer ${token}`,
});
```

##### `getHistory` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

```typescript
socket.emit('getHistory', {
  authorization: `Bearer ${token}`,
});
```

##### `getStatus` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏

```typescript
socket.emit('getStatus', {
  jobId: '68fdf9e08677e182336390b2',
  authorization: `Bearer ${token}`,
});
```

#### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç)

##### `result` - –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞

```typescript
{
  "jobId": "68fdf9e08677e182336390b2",
  "success": true,
  "error": "",
  "semi_major_axis_au": 3.2,
  "eccentricity": 0.65,
  "inclination_deg": 12.5,
  "longitude_ascending_node_deg": 45,
  "argument_perihelion_deg": 80,
  "perihelion_passage_jd": 2460500.5,
  "closest_approach_jd": 2460600.5,
  "closest_distance_au": 0.8
}
```

##### `status` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

```typescript
{
  "jobId": "68fdfb638677e182336390bb",
  "status": "queued" | "processing" | "completed" | "error"
}
```

##### `error` - –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```typescript
{
  "jobId": "68fdf9e08677e182336390b2",
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "message": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
}
```

##### `historyList` - –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏

```typescript
[
  {
    "jobId": "...",
    "status": "completed",
    "created_at": "2025-10-26T14:30:00Z",
    "observations": [...],
    "semi_major_axis_au": 3.2,
    // ... –¥—Ä—É–≥–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  }
]
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ socketService.ts           # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Socket.IO
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ calculation/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ socketCalculation.ts   # API –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ history/
‚îÇ           ‚îî‚îÄ‚îÄ getHistory.ts          # API –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (Socket.IO)
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useCalculation/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                   # –•—É–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ useGetHistory/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts                   # –•—É–∫ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ CalculationForm/
        ‚îî‚îÄ‚îÄ index.tsx                  # –§–æ—Ä–º–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### SocketService

- Singleton –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω—ã

#### useCalculation Hook

```typescript
const {
  isCalculating, // –§–ª–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞
  currentJobId, // ID —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏
  result, // –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞
  status, // –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
  error, // –û—à–∏–±–∫–∏
  progress, // –ü—Ä–æ–≥—Ä–µ—Å—Å (0-100%)
  calculate, // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞
  resetCalculation, // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
} = useCalculation();
```

#### CalculationForm Component

- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
- Real-time –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–∞

```typescript
import { useCalculation } from '@/hooks/useCalculation';

const MyComponent = () => {
  const { calculate, isCalculating, result } = useCalculation();

  const handleCalculate = async () => {
    await calculate({
      observations: [
        { ra_hours: 11, dec_degrees: 12, timestamp: 1761473781 },
        { ra_hours: 11, dec_degrees: 12, timestamp: 1761560181 },
        { ra_hours: 11, dec_degrees: 11, timestamp: 1761646581 }
      ]
    });
  };

  return (
    <div>
      <button onClick={handleCalculate} disabled={isCalculating}>
        {isCalculating ? '–†–∞—Å—á–µ—Ç...' : '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å'}
      </button>
      {result && <div>–†–µ–∑—É–ª—å—Ç–∞—Ç: {result.semi_major_axis_au} –∞.–µ.</div>}
    </div>
  );
};
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

```typescript
import { useGetHistory } from '@/hooks/useGetHistory';

const HistoryComponent = () => {
  const { history, isLoading, error, refetch } = useGetHistory();

  if (isLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  if (error) return <div>–û—à–∏–±–∫–∞: {error}</div>;

  return (
    <div>
      {history.map(item => (
        <div key={item.id}>{item.title}</div>
      ))}
    </div>
  );
};
```

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –£—Ä–æ–≤–Ω–∏ fallback

1. **Socket –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
2. **–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞** ‚Üí –û—à–∏–±–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–∞
3. **–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚Üí –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤—Ö–æ–¥
4. **–°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫

- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –¢–∞–π–º–∞—É—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—à–∏–±–∫–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üöÄ –î–µ–ø–ª–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
NEXT_PUBLIC_API_URL=http://109.120.190.243:8001
```

### Socket.IO —Å–µ—Ä–≤–µ—Ä

- URL: `process.env.NEXT_PUBLIC_API_URL`
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã: WebSocket, Polling
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Bearer —Ç–æ–∫–µ–Ω—ã
- –¢–∞–π–º–∞—É—Ç—ã: 5 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤, 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```json
{
  "socket.io-client": "^4.x.x"
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ Socket.IO
- –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- –û—à–∏–±–∫–∏ –∏ —Ç–∞–π–º–∞—É—Ç—ã
- Fallback –∫ –∑–∞–≥–ª—É—à–∫–∞–º

### –ú–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤
- –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –¥–∞–Ω–Ω—ã—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
